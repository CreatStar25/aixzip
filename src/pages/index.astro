---
import Home from '../components/pages/Home.astro';
---

<Home lang="en" />

<script is:inline>
  (function() {
    // 1. 定义非英文的支持语言列表 (en 是根路径，不在此列)
    const supportedLocales = [
      'zh-cn', 'zh-tw', 'es', 'ar', 'pt', 'id', 'ms', 'fr', 'ru', 'hi', 
      'ja', 'de', 'ko', 'tr', 'vi', 'th', 'it', 'fa', 'nl', 'pl', 'sv', 'uk', 'ro'
    ];

    // 2. 获取用户历史选择 (最高优先级)
    const savedLang = localStorage.getItem('user_lang');

    if (savedLang) {
      // === 场景 A: 用户手动选过语言 ===
      
      // 如果用户选的是 'en'，显式保留在当前页 (根路径)，不跳转
      if (savedLang === 'en') {
        return; 
      }
      
      // 如果用户选的是其他语言，且该语言在支持列表中，则跳转
      if (supportedLocales.includes(savedLang)) {
        window.location.replace('/' + savedLang + '/');
      }
      return; // 只要有历史记录，就不再检测浏览器
    }

    // === 场景 B: 初次访问 (检测浏览器语言) ===
    const browserLang = navigator.language.toLowerCase();
    let targetLang = null;

    if (browserLang.includes('zh')) {
      // 中文特殊处理
      targetLang = (browserLang.includes('tw') || browserLang.includes('hk')) ? 'zh-tw' : 'zh-cn';
    } else {
      // 其他语言匹配前缀
      const prefix = browserLang.split('-')[0];
      if (supportedLocales.includes(prefix)) {
        targetLang = prefix;
      }
    }

    // 如果检测出的目标语言不是英文 (即不在根路径)，则跳转
    if (targetLang) {
      window.location.replace('/' + targetLang + '/');
    }
    // 如果检测结果是英文，则什么都不做，直接显示当前页面
  })();
</script>